<!DOCTYPE <!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>GeoQuizz</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"> -->
        <link rel="stylesheet" type="text/css" href="./style/css/bootstrap-grid.min.css">
        <link rel="stylesheet" type="text/css" href="./style/css/bootstrap-reboot.min.css">
        <link rel="stylesheet" type="text/css" href="./style/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" />
        <link rel="stylesheet" type="text/css" href="./style/css/player.css">
        <script src="./script/jquery.min.js"></script> 
        <script src="./script/bootstrap.bundle.min.js"></script> 
        <script src="./script/bootstrap.min.js"></script> 
    </head>

    <body>
        <div id="app">
            <div v-if="!has_started" id="header">
                <div class="col-md-10 no_padding">
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <input type="text" class="form-control" v-model="pseudo" placeholder="Pseudo" id="inputPseudo">
                        </div>
                        <div class="form-group col-md-3">
                                <select id="inputSerie" v-model="serie" class="form-control">
                                    <option value="" disabled selected>Série</option>
                                    <option value="1">Nancy</option>
                                    <option value="2">France</option>
                                    <option value="3">Monde</option>
                                </select>
                            </div>
                        <div class="form-group col-md-3">
                            <select id="inputDifficulty" v-model="dificulty" class="form-control">
                                <option value="1" selected>Facile</option>
                                <option value="2">Moyen</option>
                                <option value="3">Dificile</option>
                            </select>
                        </div>
                    </div>
                    
                    <button type="submit" v-on:click="create_game" class="btn btn-primary">New Game</button>
                </div>
            </div>
            <div id="player" v-if="has_started">
                <div class="col-md-8 no_padding">
                    <!-- MAP -->
                    <lmap>
                    </lmap>
                </div>

                <div id="right_panel" class="col-md-4 no_padding">
                    <!-- Right Menu -->
                    <div>
                        <img v-on:click="enlargedImage = true" class="img-fluid searchedImage" src="place_stan.jpg"/>
                        
                        <div v-if="enlargedImage" class="modal-container">
                            <div v-on:click="enlargedImage = false" class="modal-body">
                                <img v-on:click="enlargedImage = true" class="img-fluid enlargedImage" src="place_stan.jpg"/>
                            </div>
                        </div>
                    </div>
                    <div id="infos">
                        <h2>Score : {{score}}</h2>
                        <button v-if="has_played" @click="next_round">Photo suivante !</button>
                        <p v-if="has_played" class='alert alert-success'>bien joué</p>
                    </div>
                </div>
            </div>
        </div>  


        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
        <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"></script> 
        <script src="./components/lmap.js"></script> 
        <script>
        new Vue({
            el: '#app',
            data: { 
                has_started: false,
                create_game_error: '',
                pseudo: '',
                serie: '',
                dificulty: '',
                
                enlargedImage: false,
                game_id: '',
                token: '',
                has_played: false,
                images: [
                    {
                        url:"place_stan.jpg", 
                        lat: '48.6935244', 
                        lng:'6.1832861'
                    }
                ],
                index_img: 0,
                score: 0,
                difficulty: 500
            },


            methods: { 
                create_game(){
                    if(this.pseudo !== "")
                        document.getElementById("inputPseudo").classList.remove("is-invalid");
                    else
                        document.getElementById("inputPseudo").classList.add("is-invalid");
                    
                    if(this.serie !== "")
                        document.getElementById("inputSerie").classList.remove("is-invalid");
                    else
                        document.getElementById("inputSerie").classList.add("is-invalid");
                    
                    if((this.serie !== "") && (this.pseudo !== ""))
                        this.has_started = true;
                    

                },

                submit_choice(latlng){
                    let distance = this.distance(latlng['lat'],latlng['lng'],this.images[this.index_img]['lat'],this.images[this.index_img]['lng']);
                    if(distance < this.difficulty){
                        this.score += 5;
                    }
                    else if(distance < 2*this.difficulty){
                        this.score += 3;
                    }
                    else if(distance < 3*this.difficulty){
                        this.score += 1;
                    }
                    this.has_played = true;
                },

                next_round(){
                    this.has_played = false;
                    this.index_img++;
                },

                distance(lat1, lng1, lat2, lng2){
                    let earth_radius = 6378137;   // Terre = sphère de 6378km de rayon
                    let rlo1 = this.deg2rad(lng1);
                    let rla1 = this.deg2rad(lat1);
                    let rlo2 = this.deg2rad(lng2);
                    let rla2 = this.deg2rad(lat2);
                    let dlo = (rlo2 - rlo1) / 2;
                    let dla = (rla2 - rla1) / 2;
                    let a = (Math.sin(dla) * Math.sin(dla)) + Math.cos(rla1) * Math.cos(rla2) * (Math.sin(dlo) * Math.sin(dlo));
                    let d = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                    let meter = (earth_radius * d);

                    return meter;
                },

                deg2rad(degrees)
                {
                    var pi = Math.PI;
                    return degrees * (pi/180);
                }

            },
        });
        </script>  
    </body>
</html>